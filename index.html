<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Patron Mo</title>
<style>
body {
  font-family: Arial, sans-serif;
  text-align: center;
  background-color: #000;
  color: #fff;
}
button {
  margin: 5px;
  padding: 10px 20px;
  font-size: 16px;
  cursor: pointer;
}
canvas {
  background-color: #111;
  margin-top: 10px;
  border: 2px solid #fff;
}
.buttons { margin-top: 10px; }

#leaderboard {
  margin-top: 20px;
}
</style>
</head>
<body>

<h1>üöÄ Space Shooter</h1>

<div id="spawnScreen">
  <h2>Select a Realm</h2>
  <button onclick="openRealm(1)">Realm 1</button>
</div>

<div id="dungeonScreen" style="display:none;">
  <h2>Realm 1 - Select a Dungeon</h2>
  <button onclick="startDungeon('Easy')">Easy</button>
</div>

<p id="hud" style="display:none;"></p>

<div class="buttons" style="display:none;">
  <button id="upgradeBtn" onclick="buyUpgrade()">Upgrade Damage</button>
  <button onclick="skipWave()">Skip Wave</button>
</div>

<canvas id="game" width="600" height="400" style="display:none;"></canvas>

<div id="leaderboard" style="display:none;">
  <h2>üèÜ Easy Dungeon Leaderboard</h2>
  <ol id="leaderboardList"></ol>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const hud = document.getElementById("hud");

let coins = 0;
let damage = 1;
let upgradeCost = 10;
let wave = 1;
const maxWaves = 15;
let hearts = 5;
const maxHearts = 5;

const player = { x:280, y:350, width:40, height:20, speed:4 };
let keys = {};
let shooting = false;

let bullets = [];
let enemies = [];

const baseEnemyHP = 3;
const enemiesPerWave = 5;

let dungeonStartTime = 0;
let dungeonName = "";

// Controls
document.addEventListener("keydown", e => {
  keys[e.key.toLowerCase()] = true;
  if(e.code==="Space") shooting=true;
});
document.addEventListener("keyup", e => {
  keys[e.key.toLowerCase()] = false;
  if(e.code==="Space") shooting=false;
});

// Shooting
setInterval(()=>{
  if(!shooting) return;
  bullets.push({x:player.x+18,y:player.y});
},120);

// Spawning
function spawnWave() {
  enemies = [];
  if(wave > maxWaves) return;

  if(wave === maxWaves){
    enemies.push({
      x: 200, y: -50, width:120, height:50,
      hp: baseEnemyHP*12, type:"boss", speed:0.3
    });
    return;
  }

  for(let i=0;i<enemiesPerWave+wave;i++){
    enemies.push({
      x:Math.random()*(canvas.width-30),
      y:-Math.random()*200,
      width:30,
      height:20,
      hp: baseEnemyHP,
      speed:0.6
    });
  }
}

function movePlayer(){
  if(keys["a"]) player.x-=player.speed;
  if(keys["d"]) player.x+=player.speed;
  if(keys["w"]) player.y-=player.speed;
  if(keys["s"]) player.y+=player.speed;

  player.x=Math.max(0,Math.min(canvas.width-player.width,player.x));
  player.y=Math.max(0,Math.min(canvas.height-player.height,player.y));
}

function skipWave(){
  if(enemies.length <= 2){
    wave++;
    spawnWave();
  }
}

function update(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  movePlayer();

  ctx.fillStyle="cyan";
  ctx.fillRect(player.x,player.y,player.width,player.height);

  ctx.fillStyle="yellow";
  bullets.forEach((b,i)=>{
    b.y-=6;
    ctx.fillRect(b.x,b.y,4,10);
    if(b.y<0) bullets.splice(i,1);
  });

  enemies.forEach((e,i)=>{
    e.y+=e.speed;
    ctx.fillStyle = e.type==="boss"?"red":"pink";
    ctx.fillRect(e.x,e.y,e.width,e.height);

    if(e.y>canvas.height){
      enemies.splice(i,1);
      hearts--;
      if(hearts<=0){
        alert("Game Over!");
        location.reload();
      }
    }
  });

  bullets.forEach((b,bi)=>{
    enemies.forEach((e,ei)=>{
      if(b.x<e.x+e.width && b.x+4>e.x && b.y<e.y+e.height && b.y+10>e.y){
        e.hp-=damage;
        bullets.splice(bi,1);
        if(e.hp<=0){
          enemies.splice(ei,1);
          coins++;
        }
      }
    });
  });

  if(enemies.length===0){
    wave++;
    if(wave > maxWaves){
      finishDungeon();
      return;
    }
    spawnWave();
  }

  hud.innerText = `
Coins: ${coins}
Wave: ${wave}/${maxWaves}
Damage: ${damage}
Hearts: ${"‚ù§Ô∏è".repeat(hearts)}
`;

  document.getElementById("upgradeBtn").innerText = `Upgrade Damage (${upgradeCost})`;

  requestAnimationFrame(update);
}

// Leaderboard
function saveLeaderboard(name, time){
  let scores = JSON.parse(localStorage.getItem("easyLeaderboard")) || [];
  scores.push({ name, time });
  scores.sort((a,b)=>a.time-b.time);
  scores = scores.slice(0,5);
  localStorage.setItem("easyLeaderboard", JSON.stringify(scores));
}

function showLeaderboard(){
  const board = document.getElementById("leaderboard");
  const list = document.getElementById("leaderboardList");
  list.innerHTML = "";

  let scores = JSON.parse(localStorage.getItem("easyLeaderboard")) || [];

  scores.forEach(s=>{
    const li = document.createElement("li");
    li.textContent = `${s.name} - ${s.time}s`;
    list.appendChild(li);
  });

  board.style.display = "block";
}

function finishDungeon(){
  if(dungeonName === "Easy"){
    const timeTaken = Math.floor((Date.now() - dungeonStartTime) / 1000);
    const name = prompt("You beat Easy! Enter your name:");
    if(name) saveLeaderboard(name, timeTaken);
  }

  alert("Dungeon Completed!");
  showLeaderboard();

  canvas.style.display="none";
  hud.style.display="none";
  document.querySelector(".buttons").style.display="none";
  document.getElementById("spawnScreen").style.display="block";

  resetGame();
}

function resetGame(){
  coins = 0;
  damage = 1;
  upgradeCost = 10;
  wave = 1;
  hearts = maxHearts;
  bullets = [];
  enemies = [];
}

function buyUpgrade(){
  if(coins>=upgradeCost){
    coins-=upgradeCost;
    damage++;
    upgradeCost=Math.floor(upgradeCost*2.5);
  }
}

const spawnScreen = document.getElementById("spawnScreen");
const dungeonScreen = document.getElementById("dungeonScreen");

function openRealm(){
  spawnScreen.style.display="none";
  dungeonScreen.style.display="block";
}

function startDungeon(name){
  dungeonName = name;
  dungeonStartTime = Date.now();

  dungeonScreen.style.display="none";
  canvas.style.display="block";
  hud.style.display="block";
  document.querySelector(".buttons").style.display="block";

  resetGame();
  spawnWave();
}

update();
</script>
</body>
</html>
